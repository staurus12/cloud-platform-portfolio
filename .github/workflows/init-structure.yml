name: Initialize Repo Structure

on:
  workflow_dispatch:

permissions:
  contents: write   # REQUIRED for pushing commits

jobs:
  create-structure:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Create folders and files
        run: |
          set -e

          mkdir -p cloud-platform-portfolio/architecture/saas-reference-platform
          mkdir -p cloud-platform-portfolio/architecture/enterprise-landing-zone
          mkdir -p cloud-platform-portfolio/terraform/networking
          mkdir -p cloud-platform-portfolio/terraform/kubernetes
          mkdir -p cloud-platform-portfolio/terraform/security
          mkdir -p cloud-platform-portfolio/kubernetes/manifests
          mkdir -p cloud-platform-portfolio/kubernetes/helm/sample-chart
          mkdir -p cloud-platform-portfolio/cicd/github-actions
          mkdir -p cloud-platform-portfolio/cicd/jenkins
          mkdir -p cloud-platform-portfolio/ai-delivery
          mkdir -p cloud-platform-portfolio/sre-observability
          mkdir -p cloud-platform-portfolio/case-studies
          mkdir -p cloud-platform-portfolio/docs

          touch cloud-platform-portfolio/README.md

          touch cloud-platform-portfolio/architecture/saas-reference-platform/architecture-diagram.png
          touch cloud-platform-portfolio/architecture/saas-reference-platform/architecture.md
          touch cloud-platform-portfolio/architecture/saas-reference-platform/decisions.md

          touch cloud-platform-portfolio/architecture/enterprise-landing-zone/landing-zone-diagram.png
          touch cloud-platform-portfolio/architecture/enterprise-landing-zone/landing-zone.md

          touch cloud-platform-portfolio/terraform/networking/main.tf
          touch cloud-platform-portfolio/terraform/kubernetes/main.tf
          touch cloud-platform-portfolio/terraform/security/iam.tf

          touch cloud-platform-portfolio/kubernetes/manifests/app-deployment.yaml
          touch cloud-platform-portfolio/kubernetes/manifests/service.yaml
          touch cloud-platform-portfolio/kubernetes/manifests/ingress.yaml

          touch cloud-platform-portfolio/cicd/github-actions/pipeline.yaml
          touch cloud-platform-portfolio/cicd/jenkins/Jenkinsfile

          touch cloud-platform-portfolio/ai-delivery/ai-dev-workflow.md
          touch cloud-platform-portfolio/ai-delivery/test-generation-example.md
          touch cloud-platform-portfolio/ai-delivery/pr-review-bot.md

          touch cloud-platform-portfolio/sre-observability/slis-slos.md
          touch cloud-platform-portfolio/sre-observability/prometheus.yaml
          touch cloud-platform-portfolio/sre-observability/grafana-dashboard.json

          touch cloud-platform-portfolio/case-studies/ai-accelerated-delivery.md
          touch cloud-platform-portfolio/case-studies/cloud-modernization.md
          touch cloud-platform-portfolio/case-studies/devops-transformation.md

          touch cloud-platform-portfolio/docs/production-readiness-checklist.md
          touch cloud-platform-portfolio/docs/security-baseline.md
          touch cloud-platform-portfolio/docs/cost-optimization.md

      - name: Commit & Push if changes exist
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add .

          if git diff --cached --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Auto-generate portfolio structure"
            git push
          fi
